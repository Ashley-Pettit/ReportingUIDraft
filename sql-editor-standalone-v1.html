
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>SQL Editor — Standalone</title>
  <style>
    :root{
      --bg:#0b1220; --bg-2:#0f172a; --line:#e5e7eb; --ink:#111827;
      --muted:#6b7280; --hint:#94a3b8; --focus:rgba(59,130,246,.25);
      --btn:#111827; --btn-ink:#fff; --btn-2:#f3f4f6; --btn-2-ink:#111827;
      --radius:12px; --input-h:36px;
    }
    html, body { height:100%; }
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background:#ffffff; color:var(--ink);
      display:grid; place-items:center; padding:16px;
    }
    .shell{
      width: min(1200px, 100%);
      border:1px solid var(--line); border-radius:16px; overflow:hidden;
      box-shadow: 0 10px 30px rgba(2,6,23,.08);
    }
    .header{
      padding:12px 12px; background:#f8fafc; border-bottom:1px solid var(--line);
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
    }
    .title{ font-weight:600; }
    .toolbar{
      display:flex; align-items:center; gap:8px; flex-wrap:wrap;
      margin-left:auto;
    }
    .toolbar .group{
      display:flex; align-items:center; gap:6px; flex-wrap:wrap;
    }
    .toolbar select, .toolbar button{
      height:32px; border:1px solid var(--line); border-radius:10px;
      background:#fff; color:#111827; padding:0 10px; font-size:13px; cursor:pointer;
    }
    .toolbar button.primary{ background:#111827; color:#fff; }
    .toolbar select{ max-width:180px; }
    @media (max-width:520px){
      .toolbar select{ flex:1 1 100%; max-width:100%; }
    }

    .editor-wrap{
      border-top:1px solid var(--line); background:var(--bg-2);
      display:grid; grid-template-rows:auto minmax(280px, 60vh); 
    }
    .editor-toolbar{
      display:flex; align-items:center; gap:8px; flex-wrap:wrap;
      padding:8px; border-bottom:1px solid rgba(148,163,184,.25); color:#e5e7eb;
      background:var(--bg-2);
    }
    .editor-toolbar .row{ display:flex; align-items:center; gap:6px; flex-wrap:wrap; }
    .editor-toolbar .spacer{ flex:1 }
    .editor-toolbar button, .editor-toolbar select{
      height:32px; border:1px solid rgba(148,163,184,.35); border-radius:10px;
      background:#0b1220; color:#e5e7eb; padding:0 10px; font-size:13px; cursor:pointer;
      white-space:nowrap;
    }
    .editor-toolbar button:hover{ outline:1px solid rgba(59,130,246,.35); }
    .editor-pad{ resize:vertical; overflow:auto; }

    /* CodeMirror theming */
    .CodeMirror { height: 100% !important; font-size: 14px; line-height: 1.6; }
    .cm-s-material-darker.CodeMirror{ background:#0b1220; color:#e5e7eb; }
    .cm-s-material-darker .CodeMirror-gutters{ background:#0f172a; border-right:1px solid rgba(148,163,184,.25); color:#94a3b8; }
    .cm-s-material-darker .CodeMirror-linenumber{ color:#94a3b8; }
    .cm-s-material-darker .CodeMirror-cursor{ border-left:1px solid #fff; }
    .cm-s-material-darker .cm-string{ color:#34d399; }
    .cm-s-material-darker .cm-number{ color:#60a5fa; }
    .cm-s-material-darker .cm-keyword{ color:#facc15; font-weight:600; }
    .cm-s-material-darker .cm-comment{ color:#9ca3af; font-style:italic; }
    .cm-s-material-darker .cm-atom{ color:#a78bfa; }
    .cm-s-material-darker .cm-def{ color:#22d3ee; }
    .cm-s-material-darker .CodeMirror-activeline-background { background: rgba(59,130,246,.08); }
    .cm-s-material-darker .CodeMirror-selected { background: rgba(34,197,94,.25); }

    /* Helper ribbon */
    .ribbon{ padding:8px 12px; background:#fef3c7; border-top:1px solid #fde68a; color:#78350f; font-size:13px; }
  </style>

  <!-- CodeMirror CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/material-darker.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/hint/show-hint.min.css">
</head>
<body>
  <div class="shell" role="region" aria-label="SQL Editor">
    <div class="header">
      <div class="title">SQL Editor</div>
      <div class="toolbar" role="toolbar" aria-label="Top toolbar">
        <div class="group">
          <label for="dialect" class="sr-only">Dialect</label>
          <select id="dialect" aria-label="SQL dialect">
            <option value="sql">ANSI SQL</option>
            <option value="postgresql">PostgreSQL</option>
            <option value="mysql">MySQL</option>
            <option value="tsql">T‑SQL</option>
          </select>
        </div>
        <div class="group">
          <button id="btnFormat" type="button" aria-label="Format SQL">Format</button>
          <button id="btnWrap" type="button" aria-label="Toggle wrap">Wrap</button>
          <button id="btnBigger" type="button" aria-label="Increase font size">A+</button>
          <button id="btnSmaller" type="button" aria-label="Decrease font size">A−</button>
          <button id="btnCopy" type="button" aria-label="Copy SQL">Copy</button>
        </div>
      </div>
    </div>

    <div class="editor-wrap">
      <div class="editor-toolbar">
        <div class="row">
          <span style="font-size:12px;color:#94a3b8">Shortcuts: Ctrl/Cmd+Enter (no-op here) • Ctrl/Cmd+S Save template</span>
        </div>
        <div class="spacer"></div>
        <div class="row" aria-hidden="true">
          <span style="font-size:12px;color:#94a3b8">Line numbers • Bracket match • Autocomplete</span>
        </div>
      </div>
      <div class="editor-pad">
        <textarea id="sqlEditor"></textarea>
      </div>
    </div>
    <div class="ribbon" id="ribbon">Ready</div>
  </div>

  <!-- CodeMirror JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/sql/sql.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/matchbrackets.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/selection/active-line.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/hint/show-hint.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/hint/sql-hint.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sql-formatter@15.3.2/dist/sql-formatter.min.js"></script>

  <script>
    (function(){
      const ribbon = document.getElementById('ribbon');
      function toast(msg){ ribbon.textContent = msg; ribbon.style.background='#dcfce7'; ribbon.style.color='#065f46';
        setTimeout(()=>{ ribbon.textContent='Ready'; ribbon.style.background='#fef3c7'; ribbon.style.color='#78350f'; }, 1200); }

      const textarea = document.getElementById('sqlEditor');
      textarea.value = `-- Example query
SELECT e.t4,
       COALESCE(e.preferred_name, e.first_name) AS first_name,
       e.last_name, e.status, e.start_date
FROM core_lite.employees e
WHERE e.status = 'A'
ORDER BY e.start_date DESC
LIMIT 250;`;

      let cm = CodeMirror.fromTextArea(textarea, {
        mode: "text/x-sql",
        theme: "material-darker",
        lineNumbers: true,
        styleActiveLine: true,
        matchBrackets: true,
        autofocus: true,
        indentWithTabs: false,
        smartIndent: true,
        tabSize: 2,
        indentUnit: 2,
        lineWrapping: false,
        extraKeys: {
          "Ctrl-Space": "autocomplete",
          "Cmd-S": saveTemplate,
          "Ctrl-S": saveTemplate,
          "Tab": function(cm){ cm.execCommand("indentMore"); },
          "Shift-Tab": function(cm){ cm.execCommand("indentLess"); }
        },
        hintOptions: { completeSingle: false }
      });

      // Button wiring
      let wrapped = false, fontSize = 14;
      function applyFont(){ cm.getWrapperElement().style.fontSize = fontSize + 'px'; cm.refresh(); }
      document.getElementById('btnWrap').onclick = ()=>{
        wrapped = !wrapped; cm.setOption('lineWrapping', wrapped);
        document.getElementById('btnWrap').textContent = wrapped ? 'Unwrap' : 'Wrap';
      };
      document.getElementById('btnBigger').onclick = ()=>{ fontSize = Math.min(24, fontSize+1); applyFont(); };
      document.getElementById('btnSmaller').onclick = ()=>{ fontSize = Math.max(11, fontSize-1); applyFont(); };
      document.getElementById('btnCopy').onclick = ()=>{
        navigator.clipboard.writeText(cm.getValue()).then(()=> toast('Copied SQL ✓'));
      };
      document.getElementById('btnFormat').onclick = ()=>{
        try{
          cm.setValue(sqlFormatter.format(cm.getValue(), { language: 'sql', uppercase: true }));
          toast('Formatted ✓');
        }catch(e){ /* ignore */ }
      };

      // Dialect select (cosmetic here)
      const dialect = document.getElementById('dialect');
      dialect.addEventListener('change', ()=> toast('Dialect: ' + dialect.value));

      function saveTemplate(){
        toast('Saved template ✓');
        return false;
      }

      // Handle container resize
      const pad = document.querySelector('.editor-pad');
      const ro = new ResizeObserver(()=>{ cm.setSize('100%', pad.clientHeight); cm.refresh(); });
      ro.observe(pad);
      cm.setSize('100%', pad.clientHeight);
    })();
  </script>
</body>
</html>
